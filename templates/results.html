{% extends 'base.html' %}

{% block content %}

{{prosCons}}

<script>
function getLLMResponse(major, course, info) {
	abrevToFull = {
		"CE": "Computer Engineer",
		"CMPSC": "Computer Science",
		"FMS": "Financial Mathematics and Statistics",
		"MATH": "Mathematics",
		"PRFMS": "Financial Mathematics and Statistics",
		"PRSDS": "Statistics and Data Science",
		"SDS": "Statistics and Data Science"
	}

	major = abrevToFull[major]

	var t;

	$.ajax({
		async: false,
		type: "POST",
		url: "llminterface",
		contentType: "application/json",
		data: JSON.stringify({
			"major": major,
			"course": course,
			"info": info
		}),
		dataType: "json",
		success: function(data) {
			t = data['text']
		}
	})
	return t;
}

// console.log(getLLMResponse("CMPSC","CMPSC 16"))

</script>

<h3 class="navy fw-bold">Your Course Registration Plan</h3>
<p class="text-secondary">Based on your completed courses and historic enrollment trends</p>

{% for passtime, classes in classes_per_passtime|dictsort %}
	<div class="mt-4 d-flex justify-content-between">
		<h5 class="navy fw-bold">Take These {{passtime|title}}</h5>
		{%if passtime_per_quarter.get(passtime) %}
		<p class="text-secondary">Begins {{passtime_per_quarter.get(passtime, '') | naturaldate}}, 2023</p>
		{%endif%}
	</div>
	<div class="row row-cols-1 row-cols-lg-2 g-4">
		{%for c in classes%}
		<div class="col">
			<div class="card border-0 shadow-sm">
				<div class="card-body">
					<p class="card-title fw-bold">{{c.class_name}} - {{c.class_fullname}}</p>
					<div class="ms-2 row g-2 row-cols-1 row-cols-lg-2">
						{%for category, msgs in c.msgs.items()%}
							{% for m in msgs %}
								<div class="col border-1 text-nowrap">
									<small class="text-{{'success' if category == 'pros' else 'warning' if category == 'neutral' else 'danger'}}">{{m}}</small>
								</div>
							{%endfor%}
						{%endfor%}
					</div>
					<div class="d-flex justify-content-between align-items-top">
            <div>
              <i class="bi bi-robot" style="font-size:40px;position:absolute" data-bs-toggle="popover" data-bs-trigger="hover focus" data-course="{{c.class_name}}"></i>
            </div>
          <a href="{{url_for('enrollment_each', acronym=c.class_name)}}" class="d-flex mt-3 btn text-primary p-0">See enrollment trends <i class="ms-1 bi bi-arrow-right"></i></a>
          </div>
				</div>
			</div>
		</div>
		{%endfor%}
	</div>
{%endfor%}

<script>
$(document).ready(function() {
	var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
	var queried = {}
	var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
	return new bootstrap.Popover(popoverTriggerEl, {
		content: function() {
			let acro = $(popoverTriggerEl).attr("data-course");
			let info = popoverTriggerEl.parentNode.parentNode.parentNode.querySelector('.row').innerText;
			if (queried[acro]) {
				return queried[acro]
			}
			queried[acro] = getLLMResponse("{{major}}",acro,info);
			return queried[acro]
		//   return $(popoverTriggerEl).attr("data-course");
		}
	})
	})
})
</script>
{% endblock %}
